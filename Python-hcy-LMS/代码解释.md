### **模块 1：数据文件初始化与读取**

该模块负责图书数据文件的创建（初始化）和读取解析，是数据流转的起点，确保程序能正确处理存储在文件中的图书信息。

#### 1. 导入模块与函数定义

- **`import os`**：引入操作系统相关功能，这里用`os.path.exists`判断文件是否存在。
- **`init_book_file`函数**：参数`filename`指定文件名（默认`books.txt`），功能是创建标准化的图书数据文件。

#### 2. 初始化文件核心逻辑

- **`try`块**：包裹可能出错的文件操作，用于捕获异常。

- **`os.path.exists(filename)`**：判断文件是否存在，避免重复创建导致数据丢失。

- `with open(...) as f`

  ：上下文管理器，自动关闭文件，比手动fopen/fclose更安全。

  - `'w'`模式：以 “写入” 模式打开文件，若文件不存在则创建。
  - `encoding='utf-8'`：指定编码，确保中文正常读写不出现乱码。

- **写入表头**：表头明确了每条记录的字段顺序（编号、书名、作者等），方便人和程序理解数据格式。

#### 3. 异常处理

- **`except`块**：捕获所有可能的错误（如权限不足、路径错误等），并打印错误信息，避免程序崩溃。

#### 4. 读取图书数据函数

- **`read_books`函数**：读取文件内容并解析为结构化数据（列表套字典），方便后续统计分析。
- **`books = []`**：初始化空列表，用于存放解析后的每条图书记录。

#### 5. 读取文件与解析逻辑

- **`'r'`模式**：以 “只读” 模式打开文件，读取内容。
- **`readlines()`**：一次性读取所有行，返回包含每行内容的列表（每行末尾带`\n`）。
- **`lines[1:]`**：跳过列表第一个元素（表头），只处理实际的图书记录。
- **`line.strip()`**：清除每行的`\n`和多余空格，避免解析时出现空字符串。
- **跳过空行**：如果行内容为空（`not line`），直接跳过，不处理。

#### 6. 解析字段与数据类型转换

- **`split(',')`**：按逗号分割字符串，将一条记录拆分为多个字段（如`"001,Python,张三,..."`拆分为`["001", "Python", "张三", ...]`）。
- **字段数量校验**：如果分割后不是 6 个字段，说明记录格式错误，跳过并提示。
- **字典存储**：将每个字段存入字典，用键（如`"id"`、`"price"`）标识，方便后续按字段访问。
- 数据类型转换：
  - 价格（字符串）→ `float`（用于计算平均价格）。
  - 状态（字符串）→ `int`（0 表示可借，1 表示已借，用于统计）。
- **`ValueError`捕获**：如果转换失败（如价格是字符串`"abc"`），提示 “数据类型错误” 并跳过。

#### 7. 读取结果与异常处理

- **返回结果**：成功时返回包含所有有效图书的列表（每个元素是字典）。
- 异常处理：
  - `FileNotFoundError`：文件不存在时，提示用户先调用`init_book_file`初始化。
  - 其他异常（如文件损坏、编码错误）：统一捕获并提示。

### **模块 2：图书信息统计分析**

该模块对读取到的图书数据进行统计计算，生成直观的报告，体现数据的价值（如总数量、借阅情况、价格水平）。

#### 1. 统计函数定义

- **`analyze_books`函数**：参数`books`是`read_books`返回的图书列表，功能是统计并输出报告。
- **空数据检查**：如果`books`为空（无图书记录），直接提示并返回，避免后续计算出错。

#### 2. 核心统计逻辑

- **总数量**：`len(books)`直接获取列表元素个数，即图书总本数。
- **状态统计**：通过`for`循环遍历每本图书，根据`"status"`字段的值分类计数（0→可借，1→已借出）。
- **`sum()`与生成器表达式**：`sum(book["price"] for book in books)`快速计算所有图书的价格总和（比手动循环累加更简洁）。
- **平均价格**：总价除以总数量，得到单本图书的平均价格。

#### 3. 生成统计报告

- 格式化输出：
  - `{available/total*100:.1f}%`：计算可借图书占比，保留 1 位小数（如`66.7%`）。
  - `{avg_price:.2f}`：平均价格保留 2 位小数（符合货币显示习惯，如`59.90`元）。
- **报告可读性**：用分隔线、图标（📊）和清晰的字段名，让统计结果一目了然。

### **模块协作与总结**

- **流程关系**：`init_book_file`创建文件 → `read_books`读取并解析文件 → `analyze_books`统计解析后的数据 → 输出报告。
- 核心技术点：
  - 文件操作：`open()`、`readlines()`、上下文管理器。
  - 字符串处理：`split()`分割字段、`strip()`清除空格。
  - 数据转换：字符串→浮点数 / 整数。
  - 异常处理：`try-except`捕获错误，增强程序稳定性。
  - 统计分析：`len()`、`sum()`、`for`循环、条件判断

两个模块的代码由豆包生成